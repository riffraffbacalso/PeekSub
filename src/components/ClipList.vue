<script>
  import { mapWritableState } from "pinia";
  import { useSubtitleStore, useVideoStore } from "../store";
  import Clip from "./Clip.vue";

  export default {
    components: {
      Clip,
    },
    data() {
      return {
        clipListEl: null,
        isScrolled: false,
        content: [],
      };
    },
    computed: {
      ...mapWritableState(useSubtitleStore, ["subtitleFile"]),
      ...mapWritableState(useVideoStore, ["videoFile", "duration"]),
      shadowStyle() {
        return this.isScrolled ? "box-shadow: 0px 7px 5px -7px inset" : "";
      },
    },
    methods: {
      onScroll() {
        this.isScrolled = this.clipListEl.scrollTop !== 0;
      },
    },
    watch: {
      subtitleFile() {
        let fr = new FileReader();
        fr.onload = () => {
          this.content = fr.result.split("\r\n");
        };
        fr.readAsText(this.subtitleFile);
      },
    },
    mounted() {
      this.clipListEl = this.$refs.clipListEl;
    },
  };
</script>

<template>
  <ol
    ref="clipListEl"
    class="clip-list"
    :style="shadowStyle"
    @scroll="onScroll"
  >
    <Clip v-for="line in content" :subtitle="line">
      {{ line }}
    </Clip>
  </ol>
</template>

<style>
  .clip-list {
    all: unset;
    width: 100%;
    height: calc(100% - 40px);
    padding: 20px;
    margin: 0;
    overflow-x: hidden;
    overflow-y: scroll;
  }

  .clip-list::-webkit-scrollbar {
    width: 10px;
  }

  .clip-list::-webkit-scrollbar-track {
    background: #2c3639;
  }

  .clip-list::-webkit-scrollbar-thumb {
    background: #3f4e4f;
  }

  li {
    all: unset;
  }
</style>
